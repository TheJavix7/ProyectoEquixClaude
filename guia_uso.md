# üéØ Gu√≠a de Uso - Fase 1 Completada

## üì¶ Estructura Creada

Has completado la estructura base del proyecto y la **Fase 1: Lectura y Parseo**. Aqu√≠ est√° todo lo que tienes:

### Archivos Principales

1. **config.py** - Configuraci√≥n global del proyecto
2. **requirements.txt** - Dependencias de Python
3. **main.py** - Punto de entrada (interfaz vendr√° en Fase 6)
4. **setup_project.py** - Script para crear la estructura
5. **test_phase1.py** - Script de pruebas para Fase 1

### Modelos de Datos (`models/`)

- **Player** - Representa un jugador con nombre, n√∫mero y talla
- **Piece** - Representa una pieza vectorial (delantero, manga, etc.)
- **Garment** - Representa una prenda completa (conjunto de piezas)
- **Order** - Representa un pedido completo con m√∫ltiples jugadores

### Servicios (`services/`)

- **ExcelReader** - Lee archivos Excel con pedidos
- **PDFProcessor** - Procesa PDFs con patrones vectoriales
- **PDFPatternLoader** - Carga m√∫ltiples patrones de diferentes tallas

### Utilidades (`utils/`)

- **GarmentLogger** - Sistema de logging personalizado
- **validators** - Funciones de validaci√≥n

---

## üöÄ Instalaci√≥n Paso a Paso

### 1. Crear la estructura del proyecto

```bash
# Ejecutar el script de setup
python setup_project.py
```

Esto crear√° todos los directorios necesarios.

### 2. Crear entorno virtual

```bash
# Linux/Mac
python -m venv venv
source venv/bin/activate

# Windows
python -m venv venv
venv\Scripts\activate
```

### 3. Instalar dependencias

```bash
pip install -r requirements.txt
```

### 4. Preparar archivos de prueba

Necesitas colocar:

1. **Excel del pedido**: `1. Pedido 1 Equipaciones - Temp. 25-26.xlsx`
   - En el directorio ra√≠z del proyecto

2. **PDFs de patrones**: `S.pdf`, `M.pdf`, `L.pdf`, etc.
   - En el directorio `data/templates/`
   - O en el directorio ra√≠z para pruebas

---

## üß™ Ejecutar Pruebas de la Fase 1

```bash
python test_phase1.py
```

Este script probar√°:

1. ‚úÖ **Lectura de Excel**
   - Carga del archivo
   - Extracci√≥n de jugadores
   - Resumen por tallas
   - Resumen por patrocinadores
   - Validaci√≥n de datos

2. ‚úÖ **Procesamiento de PDFs**
   - Carga de patrones
   - Extracci√≥n de piezas vectoriales
   - C√°lculo de √°reas
   - Validaci√≥n de completitud

3. ‚úÖ **Integraci√≥n**
   - Verificaci√≥n de coincidencias entre tallas pedidas y patrones disponibles
   - Estad√≠sticas completas

---

## üíª Ejemplos de Uso Program√°tico

### Ejemplo 1: Leer un pedido de Excel

```python
from services import ExcelReader

# Crear lector
reader = ExcelReader("1. Pedido 1 Equipaciones - Temp. 25-26.xlsx")

# Parsear pedido
order = reader.parse_order()

# Ver resumen
print(f"Total jugadores: {order.get_total_players()}")
print(f"Tallas: {order.get_size_summary()}")

# Validar
is_valid, errors = reader.validate_order()
if not is_valid:
    for error in errors:
        print(f"Error: {error}")
```

### Ejemplo 2: Procesar un PDF de patr√≥n

```python
from services import PDFProcessor

# Cargar PDF
processor = PDFProcessor("S.pdf")
garment = processor.create_garment()

# Ver piezas
print(f"Talla: {garment.size}")
print(f"Piezas: {len(garment.pieces)}")

for piece in garment.pieces:
    print(f"- {piece.name}: {piece.get_area_mm2():.0f} mm¬≤")

# Validar completitud
is_valid, msg = garment.validate()
print(f"V√°lido: {is_valid}")

processor.close()
```

### Ejemplo 3: Cargar m√∫ltiples patrones

```python
from services import PDFPatternLoader

# Cargar todos los patrones de un directorio
loader = PDFPatternLoader("data/templates/")
garments = loader.load_all_patterns()

# Ver tallas disponibles
print(f"Tallas disponibles: {loader.get_available_sizes()}")

# Obtener patr√≥n de una talla espec√≠fica
garment_m = loader.get_garment_by_size("M")
if garment_m:
    print(f"Patr√≥n M tiene {len(garment_m.pieces)} piezas")
```

### Ejemplo 4: Integraci√≥n completa

```python
from services import ExcelReader, PDFPatternLoader

# Leer pedido
reader = ExcelReader("pedido.xlsx")
order = reader.parse_order()

# Cargar patrones
loader = PDFPatternLoader("data/templates/")
garments = loader.load_all_patterns()

# Verificar cobertura
size_summary = order.get_size_summary()
available_sizes = loader.get_available_sizes()

for size, count in size_summary.items():
    if size in available_sizes:
        print(f"‚úÖ Talla {size}: {count} unidades - Patr√≥n disponible")
    else:
        print(f"‚ùå Talla {size}: {count} unidades - FALTA PATR√ìN")
```

---

## üìä Qu√© Datos Extraemos

### Del Excel:
- Nombre del jugador
- N√∫mero de dorsal
- Talla
- Patrocinador/Equipo
- Totales por talla
- Totales por patrocinador

### De los PDFs:
- Nombre de cada pieza (DELANTERO, POSTERIOR, etc.)
- Dimensiones (ancho √ó alto en mm)
- √Årea de cada pieza (mm¬≤)
- V√©rtices del pol√≠gono (para nesting futuro)
- Talla del patr√≥n

---

## ‚úÖ Validaciones Implementadas

### Validaci√≥n de Pedidos:
- Tallas v√°lidas (S, M, L, XL, etc.)
- Nombres no vac√≠os
- N√∫meros no duplicados por equipo
- Datos completos

### Validaci√≥n de Patrones:
- Todas las piezas necesarias presentes
- Dimensiones v√°lidas
- √Åreas calculables
- Coherencia de tallas

---

## üîú Pr√≥ximos Pasos (Fase 2)

Una vez que las pruebas de Fase 1 funcionen correctamente, el siguiente paso ser√°:

**Fase 2: Optimizaci√≥n de Agrupaci√≥n**
- Crear algoritmo para agrupar tallas en pares/tr√≠os/cuartetos
- Minimizar n√∫mero de archivos generados
- Optimizar uso de espacio en cada rollo

Archivos a crear:
- `services/grouping_optimizer.py`
- `tests/test_grouping.py`

---

## üêõ Soluci√≥n de Problemas

### Error: "No module named 'PyQt6'"
```bash
pip install PyQt6
```

### Error: "No module named 'fitz'"
```bash
pip install PyMuPDF
```

### Error: "No se encuentra el archivo Excel"
Aseg√∫rate de que el archivo est√© en el directorio correcto con el nombre exacto.

### Error: "PDF vac√≠o o sin piezas"
Verifica que el PDF contenga vectores y texto con los nombres de las piezas.

---

## üìù Notas Importantes

1. Los archivos PDF deben contener:
   - Texto con "Piece Name: NOMBRE_PIEZA"
   - Vectores dibujados (no im√°genes rasterizadas)
   - Una pieza por p√°gina

2. El archivo Excel debe seguir el formato:
   - L√≠neas "Patrocinador: NOMBRE"
   - Columnas: N√∫mero+Nombre | Talla
   - L√≠nea "TOTAL" para finalizar

3. Los logs se guardan en `data/logs/`

4. Los archivos generados ir√°n a `data/output/`

---

## üéì Arquitectura del C√≥digo

### Patr√≥n MVC
- **Models**: Datos puros (Player, Piece, Garment, Order)
- **Services**: L√≥gica de negocio (lectura, procesamiento)
- **Views**: Interfaz (Fase 6)
- **Controllers**: Orquestaci√≥n (Fases 2-5)
- **Utils**: Herramientas transversales (logging, validaci√≥n)

### Flujo de Datos
```
Excel ‚Üí ExcelReader ‚Üí Order (con Players)
PDFs ‚Üí PDFProcessor ‚Üí Garments (con Pieces)
Order + Garments ‚Üí Grouping ‚Üí Grupos optimizados (Fase 2)
Grupos ‚Üí Nesting ‚Üí Layout en rollos (Fase 4)
Layout ‚Üí AI Generator ‚Üí Archivos .ai (Fase 5)
```

---

## üìö Referencia R√°pida de Clases

### Player
```python
player = Player(
    name="FIGUEROA",
    number="6",
    size="L",
    sponsor="Pagancar"
)

# M√©todos √∫tiles
player.get_full_identifier()  # "6 FIGUEROA"
player.validate(VALID_SIZES)  # (True, "")
```

### Piece
```python
piece = Piece(
    name="POSTERIOR",
    size="M",
    width=350.0,
    height=450.0
)

# M√©todos √∫tiles
piece.calculate_area()        # Calcula √°rea en mm¬≤
piece.is_back_piece()         # True si es posterior
piece.rotate(90)              # Rota la pieza
piece.translate(100, 50)      # Mueve la pieza
```

### Garment
```python
garment = Garment(size="M")
garment.add_piece(piece)

# M√©todos √∫tiles
garment.get_back_piece()      # Obtiene pieza posterior
garment.get_total_area()      # √Årea total de todas las piezas
garment.is_complete()         # Verifica si tiene todas las piezas
garment.validate()            # (True, "")
```

### Order
```python
order = Order(name="Temporada 25-26")
order.add_player(player)

# M√©todos √∫tiles
order.get_size_summary()              # {'M': 10, 'L': 5}
order.get_players_by_size("M")        # [player1, player2, ...]
order.validate_duplicate_numbers()    # (False, [])
order.get_statistics()                # Dict completo
```

---

## üîß Configuraci√≥n Personalizada

El archivo `config.py` contiene todas las configuraciones modificables:

### Dimensiones del Rollo
```python
ROLL_CONFIG = {
    "width": 1800,      # ancho en mm
    "height": 3000,     # alto en mm
    "margin": 10,       # margen entre piezas
    "edge_margin": 20   # margen del borde
}
```

### Configuraci√≥n de Nesting (Fase 4)
```python
NESTING_CONFIG = {
    "allowed_rotations": [0, 90, 180, 270],
    "spacing": 10,
    "max_pieces_per_file": 50,
    "optimization_level": "medium"
}
```

### Configuraci√≥n de Texto
```python
TEXT_CONFIG = {
    "font_name": "Arial",
    "font_size_number": 200,
    "font_size_name": 80,
    "number_position": (0.5, 0.35),
    "name_position": (0.5, 0.65),
    "color": "#000000"
}
```

---

## üé® Personalizaci√≥n

### A√±adir nuevas tallas v√°lidas
Editar `config.py`:
```python
VALID_SIZES = ["2", "4", "6", "8", "10", "12", "14", "16", 
               "XS", "S", "M", "L", "XL", "XXL", "XXXL",
               "CUSTOM1", "CUSTOM2"]  # A√±adir aqu√≠
```

### A√±adir nuevos nombres de piezas
Editar `config.py`:
```python
PIECE_NAMES = {
    "DELANTERO": "front",
    "POSTERIOR": "back",
    "@MANGA DER": "sleeve_right",
    "@MANGA IZQ": "sleeve_left",
    "SESGO CUELLO": "collar_bias",
    "CAPUCHA": "hood"  # A√±adir aqu√≠
}
```

---

## üìà M√©tricas y Estad√≠sticas

### Informaci√≥n disponible del pedido:
- Total de equipaciones
- Distribuci√≥n por tallas
- Distribuci√≥n por patrocinadores/equipos
- N√∫meros duplicados
- Jugadores por categor√≠a

### Informaci√≥n disponible de patrones:
- √Årea de cada pieza
- √Årea total por prenda
- Dimensiones (ancho √ó alto)
- N√∫mero de v√©rtices
- Completitud del patr√≥n

---

## üß© Extensibilidad

El c√≥digo est√° dise√±ado para ser f√°cilmente extensible:

### A√±adir nuevo formato de entrada (CSV, JSON, etc.)
Crear nuevo servicio en `services/`:
```python
class CSVReader:
    def parse_order(self) -> Order:
        # Implementar l√≥gica
        pass
```

### A√±adir nuevo formato de salida (DXF, SVG, etc.)
Crear generador en `services/`:
```python
class DXFGenerator:
    def generate(self, garments):
        # Implementar l√≥gica
        pass
```

### A√±adir nuevas validaciones
A√±adir en `utils/validators.py`:
```python
def validate_custom_field(value) -> Tuple[bool, str]:
    # Implementar validaci√≥n
    return True, ""
```

---

## üîç Debugging

### Activar logs detallados
En tu c√≥digo:
```python
from utils.logger import GarmentLogger

logger = GarmentLogger("mi_modulo")
logger.debug("Mensaje de debug detallado")
logger.info("Operaci√≥n completada")
logger.error("Error encontrado", exc_info=True)
```

### Ver logs en archivo
Los logs se guardan en `data/logs/garment_YYYYMMDD.log`

### Modo verbose en pruebas
Modificar `test_phase1.py` para m√°s detalles:
```python
# A√±adir prints adicionales donde sea necesario
print(f"Debug: {variable}")
```

---

## üì¶ Estructura de Archivos Generados (Futuro)

```
data/output/
‚îú‚îÄ‚îÄ pedido_temporada_25-26/
‚îÇ   ‚îú‚îÄ‚îÄ 01_M-L_VICTOR-FIGUEROA.ai
‚îÇ   ‚îú‚îÄ‚îÄ 02_M-L_ITALO-LOPEZ.ai
‚îÇ   ‚îú‚îÄ‚îÄ 03_S_IVAN-RUBEN.ai
‚îÇ   ‚îú‚îÄ‚îÄ index.csv                    # √çndice de archivos
‚îÇ   ‚îî‚îÄ‚îÄ resumen.txt                  # Resumen del pedido
```

Cada archivo `.ai` contendr√°:
- M√∫ltiples prendas (seg√∫n agrupaci√≥n)
- Nombres y n√∫meros personalizados
- Layout optimizado (nesting)
- Metadata del pedido

---

## üö¶ Checklist de Fase 1

Antes de continuar a la Fase 2, verifica:

- [ ] ‚úÖ `setup_project.py` ejecutado correctamente
- [ ] ‚úÖ Entorno virtual creado y activado
- [ ] ‚úÖ Dependencias instaladas (`pip install -r requirements.txt`)
- [ ] ‚úÖ Archivos de prueba ubicados correctamente
- [ ] ‚úÖ `test_phase1.py` ejecutado sin errores
- [ ] ‚úÖ Excel parseado correctamente
- [ ] ‚úÖ PDFs procesados correctamente
- [ ] ‚úÖ Validaciones funcionando
- [ ] ‚úÖ Logs generados en `data/logs/`
- [ ] ‚úÖ Todas las tallas del pedido tienen patrones disponibles

---

## üí° Tips y Buenas Pr√°cticas

1. **Siempre validar antes de procesar**
   ```python
   is_valid, errors = reader.validate_order()
   if not is_valid:
       # Manejar errores antes de continuar
   ```

2. **Usar context managers para PDFs**
   ```python
   with PDFProcessor("pattern.pdf") as processor:
       garment = processor.create_garment()
   # PDF se cierra autom√°ticamente
   ```

3. **Cachear resultados pesados**
   ```python
   # Guardar garments cargados para reutilizar
   self.cached_garments = loader.load_all_patterns()
   ```

4. **Logging en operaciones importantes**
   ```python
   logger.info(f"Procesando pedido con {order.get_total_players()} jugadores")
   ```

5. **Manejar excepciones espec√≠ficas**
   ```python
   try:
       order = reader.parse_order()
   except ValueError as e:
       logger.error(f"Error de validaci√≥n: {e}")
   except Exception as e:
       logger.error(f"Error inesperado: {e}", exc_info=True)
   ```

---

## üéØ Objetivos de la Fase 2

Una vez completada la Fase 1, los objetivos de la Fase 2 ser√°n:

1. **Algoritmo de Agrupaci√≥n Inteligente**
   - Agrupar tallas con la misma cantidad
   - Minimizar el n√∫mero de archivos finales
   - Maximizar la eficiencia del espacio

2. **Calculador de Multiplicaci√≥n**
   - Determinar repeticiones necesarias
   - Distribuir prendas entre archivos

3. **Optimizador de Combinaciones**
   - Encontrar mejores pares/tr√≠os/cuartetos
   - Balance entre cantidad de archivos y tama√±o

**Ejemplo de agrupaci√≥n √≥ptima:**
```
Pedido: 15√óM, 15√óL, 10√óS, 5√óXL

Agrupaci√≥n √≥ptima:
- Grupo 1: (M+L) √ó 15 repeticiones = 15M + 15L ‚úì
- Grupo 2: (S+S) √ó 5 repeticiones = 10S ‚úì
- Grupo 3: XL √ó 5 repeticiones = 5XL ‚úì

Total: 3 archivos en lugar de 45
```

---

## üìû Soporte y Ayuda

Si encuentras problemas:

1. Revisa los logs en `data/logs/`
2. Ejecuta `test_phase1.py` para diagn√≥stico
3. Verifica la estructura de archivos
4. Comprueba las versiones de dependencias
5. Revisa esta gu√≠a completa

---

## üéâ ¬°Felicidades!

Has completado exitosamente la **Fase 1** del proyecto. Tienes:

‚úÖ Estructura completa del proyecto
‚úÖ Modelos de datos robustos
‚úÖ Lector de Excel funcional
‚úÖ Procesador de PDFs funcional
‚úÖ Sistema de validaci√≥n
‚úÖ Sistema de logging
‚úÖ Tests automatizados

**¬°Est√°s listo para la Fase 2!** üöÄ